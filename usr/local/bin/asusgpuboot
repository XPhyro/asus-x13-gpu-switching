#!/usr/bin/env sh

GPUFILE=/etc/asus_nvidia

if [ -f "$GPUFILE" ]; then
    printf "%s\n" "activating and loading Nvidia"
    modprobe nvidia_uvm
    modprobe nvidia_drm
    modprobe nvidia_modeset
    modprobe nvidia
  
    printf "%s\n" "setting nvidia power/control auto"
    printf "%s\n" 'auto' > /sys/bus/pci/devices/0000\:01\:00.0/power/control
else
    printf "%s\n" "deactivating nvidia"
    printf "%s\n" 1 > /sys/bus/pci/devices/0000\:01\:00.0/remove
fi
